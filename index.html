<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="manifest" href="manifest.json">
    <title>Calendario de Turnos Pro</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-900 text-gray-100">

    <div id="loginScreen" class="fixed inset-0 z-50 flex items-center justify-center bg-black/90 p-4 hidden">
        <div class="card p-8 rounded-2xl w-full max-w-sm border border-gray-800">
            <div class="text-center mb-8">
                <div class="inline-block p-4 rounded-full bg-blue-600/20 mb-4">
                    <i class="fas fa-calendar-check text-4xl text-blue-500"></i>
                </div>
                <h2 class="text-2xl font-bold">Turnos Chile</h2>
                <p class="text-gray-400 text-sm mt-2">Sincronización en la nube</p>
            </div>
            <input type="email" id="loginEmail" placeholder="Correo" class="w-full p-3 rounded-xl mb-3">
            <input type="password" id="loginPass" placeholder="Contraseña" class="w-full p-3 rounded-xl mb-6">
            <button onclick="login()" class="w-full py-3 bg-blue-600 hover:bg-blue-500 rounded-xl font-bold transition mb-4">INGRESAR</button>
            <button onclick="registro()" class="w-full text-sm text-gray-400 hover:text-white">Crear cuenta nueva</button>
        </div>
    </div>

    <div id="appContent" class="hidden min-h-screen pb-20">
        <div class="container mx-auto px-4 py-4 max-w-6xl">
            <header class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                <div class="flex items-center gap-3">
                    <h1 class="text-2xl font-bold text-blue-400"><i class="fas fa-layer-group mr-2"></i>Mis Turnos</h1>
                </div>
                <div class="flex items-center gap-2 w-full md:w-auto">
                    <button onclick="cerrarSesion()" class="bg-red-500/10 text-red-400 hover:bg-red-500/20 px-4 py-2 rounded-lg text-sm font-bold border border-red-500/20"><i class="fas fa-sign-out-alt mr-2"></i>Salir</button>
                </div>
            </header>

            <div class="card p-4 rounded-2xl mb-6">
                <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                    <div id="monthYear" class="text-xl font-black text-white uppercase tracking-wide"></div>
                    <div class="flex gap-2">
                        <button onclick="cambiarMes(-1)" class="p-2 px-4 bg-gray-800 rounded-lg hover:bg-gray-700 border border-gray-700"><i class="fas fa-chevron-left"></i></button>
                        <button onclick="goToToday()" class="p-2 px-4 bg-blue-600/20 text-blue-400 rounded-lg hover:bg-blue-600/30 border border-blue-500/30 font-bold text-sm">HOY</button>
                        <button onclick="cambiarMes(1)" class="p-2 px-4 bg-gray-800 rounded-lg hover:bg-gray-700 border border-gray-700"><i class="fas fa-chevron-right"></i></button>
                        <select id="monthSelect" onchange="actualizarCalendario()" class="rounded-lg p-2 bg-gray-800 border-gray-700"></select>
                        <select id="yearSelect" onchange="actualizarCalendario()" class="rounded-lg p-2 bg-gray-800 border-gray-700"></select>
                    </div>
                </div>
            </div>

            <div class="flex overflow-x-auto gap-6 border-b border-gray-800 mb-6 px-2">
                <button onclick="cambiarPestaña('calendario')" class="tab-btn active pb-3 font-bold text-sm whitespace-nowrap">CALENDARIO</button>
                <button onclick="cambiarPestaña('estadisticas')" class="tab-btn pb-3 font-bold text-sm text-gray-500 whitespace-nowrap">ESTADÍSTICAS</button>
                <button onclick="cambiarPestaña('herramientas')" class="tab-btn pb-3 font-bold text-sm text-gray-500 whitespace-nowrap">HERRAMIENTAS</button>
                <button onclick="cambiarPestaña('configuracion')" class="tab-btn pb-3 font-bold text-sm text-gray-500 whitespace-nowrap">CONFIGURACIÓN</button>
            </div>

            <div id="tab-calendario" class="tab-content block">
                <div class="grid grid-cols-7 gap-1 md:gap-3 mb-8" id="calendar"></div>
                <div id="annualView" class="hidden mt-8 card p-4 rounded-xl"></div>
            </div>

            <div id="tab-estadisticas" class="tab-content hidden space-y-6">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="card p-4 rounded-xl text-center border-l-4 border-blue-500">
                        <div class="text-xs text-gray-400 uppercase mb-1">Trabajados</div>
                        <div id="statTrabajados" class="text-2xl font-bold text-white">0</div>
                    </div>
                    <div class="card p-4 rounded-xl text-center border-l-4 border-green-500">
                        <div class="text-xs text-gray-400 uppercase mb-1">Libres</div>
                        <div id="statLibres" class="text-2xl font-bold text-white">0</div>
                    </div>
                    <div class="card p-4 rounded-xl text-center border-l-4 border-yellow-500">
                        <div class="text-xs text-gray-400 uppercase mb-1">H. Normales</div>
                        <div id="statNormales" class="text-2xl font-bold text-white">0</div>
                    </div>
                    <div class="card p-4 rounded-xl text-center border-l-4 border-purple-500">
                        <div class="text-xs text-gray-400 uppercase mb-1">H. Extras</div>
                        <div id="statExtras" class="text-2xl font-bold text-white">0</div>
                    </div>
                </div>
                <div class="card p-4 rounded-xl">
                    <h3 class="font-bold mb-4">Detalle de Turnos</h3>
                    <textarea id="detalleTexto" class="w-full h-40 p-3 rounded-lg text-xs font-mono" readonly></textarea>
                </div>
            </div>

            <div id="tab-herramientas" class="tab-content hidden space-y-4">
                <div class="card p-6 rounded-xl">
                    <h3 class="font-bold mb-4 text-lg"><i class="fas fa-file-export mr-2 text-blue-400"></i>Exportación</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button onclick="exportarAPDF()" class="p-4 bg-gray-800 rounded-xl hover:bg-gray-700 border border-gray-700 text-left transition flex items-center">
                            <i class="fas fa-file-pdf text-2xl text-red-400 mr-4"></i>
                            <div>
                                <div class="font-bold">PDF Mensual</div>
                                <div class="text-xs text-gray-400">Descargar vista actual</div>
                            </div>
                        </button>
                        <button onclick="exportarUnificado()" class="p-4 bg-gray-800 rounded-xl hover:bg-gray-700 border border-gray-700 text-left transition flex items-center">
                            <i class="fas fa-table text-2xl text-green-400 mr-4"></i>
                            <div>
                                <div class="font-bold">Reporte Anual</div>
                                <div class="text-xs text-gray-400">Resumen completo del año</div>
                            </div>
                        </button>
                    </div>
                </div>
                
                <div class="card p-6 rounded-xl border-red-900/30">
                    <h3 class="font-bold mb-4 text-red-400">Zona de Peligro</h3>
                    <button onclick="limpiarMes()" class="w-full p-3 bg-red-600/20 text-red-400 hover:bg-red-600/30 rounded-lg border border-red-500/30 font-bold">
                        <i class="fas fa-trash mr-2"></i>Borrar turnos de este mes
                    </button>
                </div>
            </div>

            <div id="tab-configuracion" class="tab-content hidden">
                <div class="card p-6 rounded-xl max-w-2xl mx-auto">
                    <h3 class="text-xl font-bold mb-6 text-blue-400"><i class="fas fa-magic mr-2"></i>Asistente de Turnos</h3>
                    
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-bold mb-2 text-gray-300">Patrón de Trabajo</label>
                            <select id="patronSelect" onchange="toggleCustomPattern()" class="w-full p-3 rounded-xl bg-gray-800 border-gray-700">
                                <option value="4x4">4x4 (4 Trabajo / 4 Libre)</option>
                                <option value="5x2">5x2 (5 Trabajo / 2 Libre)</option>
                                <option value="6x1">6x1 (6 Trabajo / 1 Libre)</option>
                                <option value="7x7">7x7 (7 Trabajo / 7 Libre)</option>
                                <option value="3x3" selected>3x3 (3 Trabajo / 3 Libre)</option>
                                <option value="custom">Personalizado...</option>
                            </select>
                        </div>

                        <div id="customPatternDiv" class="hidden grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs mb-1">Días Trabajo</label>
                                <input type="number" id="diasTrabajo" value="3" class="w-full p-3 rounded-xl text-center">
                            </div>
                            <div>
                                <label class="block text-xs mb-1">Días Libre</label>
                                <input type="number" id="diasDescanso" value="3" class="w-full p-3 rounded-xl text-center">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-bold mb-2 text-gray-300">Rotación</label>
                            <select id="tipoRotacion" class="w-full p-3 rounded-xl bg-gray-800 border-gray-700">
                                <option value="dia-noche">Día / Noche Alternado</option>
                                <option value="solo-dia">Solo Día</option>
                                <option value="solo-noche">Solo Noche</option>
                                <option value="noche-noche-dia">2 Noches - 1 Día (Ciclo)</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-bold mb-2 text-gray-300">Fecha de Inicio del Ciclo</label>
                            <input type="date" id="fechaInicio" class="w-full p-3 rounded-xl bg-gray-800 border-gray-700">
                            <p class="text-xs text-gray-500 mt-2">* Si no eliges fecha, se usará el 1 del mes actual.</p>
                        </div>

                        <button onclick="completarCalendario()" class="w-full py-4 bg-blue-600 hover:bg-blue-500 rounded-xl font-bold text-white shadow-lg shadow-blue-900/50 transition transform active:scale-95">
                            APLICAR AL MES ACTUAL
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="turnoModal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-black/90 hidden backdrop-blur-sm p-4">
        <div class="modal-content card p-6 rounded-2xl w-full max-w-sm animate-enter">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-bold">Editar Día</h3>
                <button onclick="cerrarModal()" class="text-gray-400 hover:text-white"><i class="fas fa-times"></i></button>
            </div>
            
            <div class="grid grid-cols-2 gap-3 mb-6">
                <button onclick="selectTurnoModal('dia')" class="p-4 rounded-xl bg-yellow-500/20 text-yellow-400 border border-yellow-500/30 hover:bg-yellow-500/30 transition flex flex-col items-center gap-2">
                    <i class="fas fa-sun text-2xl"></i>
                    <span class="font-bold text-sm">DÍA</span>
                </button>
                <button onclick="selectTurnoModal('noche')" class="p-4 rounded-xl bg-indigo-600/20 text-indigo-400 border border-indigo-500/30 hover:bg-indigo-600/30 transition flex flex-col items-center gap-2">
                    <i class="fas fa-moon text-2xl"></i>
                    <span class="font-bold text-sm">NOCHE</span>
                </button>
                <button onclick="selectTurnoModal('extra-dia')" class="p-3 rounded-xl bg-orange-600/20 text-orange-400 border border-orange-500/30 hover:bg-orange-600/30 font-bold text-xs">
                    EXTRA DÍA
                </button>
                <button onclick="selectTurnoModal('extra-noche')" class="p-3 rounded-xl bg-purple-600/20 text-purple-400 border border-purple-500/30 hover:bg-purple-600/30 font-bold text-xs">
                    EXTRA NOCHE
                </button>
            </div>

            <textarea id="nota" placeholder="Añadir una nota..." class="w-full p-3 rounded-xl bg-gray-800 border-gray-700 mb-4 text-sm"></textarea>
            
            <button onclick="quitarTurno()" class="w-full py-3 bg-red-500/10 text-red-400 hover:bg-red-500/20 rounded-xl font-bold border border-red-500/20 transition">
                Borrar Turno
            </button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="module">
        window.SUPABASE_URL = 'https://kjhrxdnwuwdmktdwuhdi.supabase.co';
        window.SUPABASE_KEY = 'sb_publishable_0nvqhjvJiytEFeif99jVsg_eiqOtXh9';
        window.supabase = supabase.createClient(window.SUPABASE_URL, window.SUPABASE_KEY);
    </script>
    <script type="module" src="script.js"></script>
</body>
</html>